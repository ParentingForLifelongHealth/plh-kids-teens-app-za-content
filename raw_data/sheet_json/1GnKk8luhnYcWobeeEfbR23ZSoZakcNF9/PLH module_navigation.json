{
  "==content_list==": [
    {
      "flow_type": "template",
      "flow_name": "module_path",
      "status": "released"
    },
    {
      "flow_type": "template",
      "flow_name": "module_list",
      "status": "released"
    },
    {
      "flow_type": "template",
      "flow_name": "module_list_item",
      "status": "released"
    },
    {
      "flow_type": "template",
      "flow_name": "module_path_debug",
      "status": "draft"
    },
    {
      "flow_type": "template",
      "flow_name": "module_landing",
      "status": "released",
      "parameter_list": "app_config.LAYOUT.page_padding: 0 0;"
    },
    {
      "flow_type": "template",
      "flow_name": "module_landing_sub",
      "status": "released"
    },
    {
      "flow_type": "generator",
      "flow_name": "gen_stack_module",
      "status": "released",
      "parameter_list": "input_data_list: modules;\noutput_flow_name: stack_module_@gen.id;\noutput_flow_type: template;"
    },
    {
      "flow_type": "generator",
      "flow_name": "gen_stack_module_start_at_id",
      "status": "released",
      "parameter_list": "input_data_list: modules;\noutput_flow_name: stack_module_{@gen.id}_start_at_id;\noutput_flow_type: template;"
    },
    {
      "flow_type": "generator",
      "flow_name": "gen_module_landing",
      "status": "draft",
      "parameter_list": "input_data_list: modules;\noutput_flow_name: module_landing_@gen.id;\noutput_flow_type: template;"
    }
  ],
  "module_path": [
    {
      "name": "background_image_asset",
      "value": "images/backgrounds/map_view_bg.jpg",
      "exclude_from_translation": true
    },
    {
      "name": "current_module_id"
    },
    {
      "name": "completed_count"
    },
    {
      "type": "data_items",
      "name": "compute_completed_length",
      "value": "@data.module_tasks",
      "action_list": "data_changed | set_local : completed_count : @items.length",
      "parameter_list": "filter: @item.completed && (!@item.tag_list || @item.tag_list.includes(@fields.child_age_tag));"
    },
    {
      "type": "data_items",
      "name": "compute_current_module_id",
      "value": "@data.module_tasks",
      "action_list": "data_changed | set_local : current_module_id : @items[0]?.id",
      "parameter_list": "filter: !@item.completed && (!@item.tag_list || @item.tag_list.includes(@fields.child_age_tag));\nsort: number;\nlimit: 1;"
    },
    {
      "type": "text",
      "name": "debug_current_module",
      "value": "Current Module: @local.current_module_id",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "type": "begin_display_group",
      "name": "dg_all_modules",
      "parameter_list": "style: column;",
      "condition": "@local.completed_count !== undefined",
      "exclude_from_translation": true,
      "style_list": "background-image: url(\"assets/app_data/assets/images/background_pattern_blue.svg\");\nbackground-repeat: repeat;\nbackground-position: top center;\nbackground-size: 670px;",
      "comments": "This should be in the parameter list:\nbackground_image_asset: images/background_pattern_blue.svg;\n\nMoved here as couldn't get the image to not resize as it is in a wrapper below where css gets populated"
    },
    {
      "type": "begin_progress_path",
      "parameter_list": "variant: curved;\nvertical_spacing: 10;",
      "exclude_from_translation": true
    },
    {
      "name": "is_highlighted",
      "value": false
    },
    {
      "type": "begin_data_items",
      "name": "task_cards",
      "value": "@data.module_tasks",
      "parameter_list": "filter: !@item.tag_list || @item.tag_list.includes(@fields.child_age_tag);\nsort: number;",
      "exclude_from_translation": true
    },
    {
      "name": "completed_midnight",
      "value": "@calc(new Date(@item.completed_ts).setHours(0,0,0,0))",
      "exclude_from_translation": true
    },
    {
      "name": "days_since_completed",
      "value": "@calc(window.date_fns.differenceInDays(now(),new Date(@local.completed_midnight)))",
      "exclude_from_translation": true
    },
    {
      "name": "is_highlighted",
      "value": "@local.days_since_completed >= +@fields.countdown_days",
      "exclude_from_translation": true
    },
    {
      "type": "plh_module_list_item",
      "name": "locked_@item.id",
      "action_list": "click | go_to: module_landing_@item.id",
      "parameter_list": "variant: circle;\nmodule_image_asset: @item.image_asset;\nlocked_image_asset: images/icons/locked.png;\nis_locked: TRUE;\nhighlighted: @local.is_highlighted;",
      "condition": "!(@item.id == @local.current_module_id || @item.completed)",
      "exclude_from_translation": true
    },
    {
      "type": "plh_module_list_item",
      "name": "unlocked_@item.id",
      "action_list": "click | go_to: module_landing_@item.id",
      "parameter_list": "variant: circle;\nmodule_image_asset: @item.image_asset;\nlocked_image_asset: images/icons/locked.png;\nis_locked: FALSE;\nhighlighted: @local.is_highlighted;",
      "condition": "@item.id == @local.current_module_id || @item.completed",
      "exclude_from_translation": true
    },
    {
      "type": "end_data_items",
      "exclude_from_translation": true
    },
    {
      "type": "end_progress_path",
      "exclude_from_translation": true
    },
    {
      "type": "end_display_group",
      "exclude_from_translation": true
    }
  ],
  "module_list": [
    {
      "name": "background_list",
      "value": "var(--plh-module-list-item-background-1);\nvar(--plh-module-list-item-background-2);\nvar(--plh-module-list-item-background-3);"
    },
    {
      "name": "current_module_id"
    },
    {
      "type": "data_items",
      "value": "@data.module_tasks",
      "action_list": "data_changed | set_local : current_module_id : @items[0]?.id",
      "parameter_list": "filter: !@item.completed && (!@item.tag_list || @item.tag_list.includes(@fields.child_age_tag));\nsort: number;\nlimit: 1;"
    },
    {
      "type": "begin_display_group",
      "name": "dg_all_modules",
      "parameter_list": "style: column"
    },
    {
      "type": "begin_data_items",
      "name": "loop_modules",
      "value": "@data.module_tasks",
      "parameter_list": "filter: !@item.tag_list || @item.tag_list.includes(@fields.child_age_tag);\nsort: number;",
      "exclude_from_translation": true
    },
    {
      "name": "index_modulo_3",
      "value": "@calc(@item._index % 3)"
    },
    {
      "type": "begin_template",
      "name": "module_@item.id",
      "value": "module_list_item",
      "exclude_from_translation": true
    },
    {
      "name": "module_id",
      "value": "@item.id",
      "exclude_from_translation": true
    },
    {
      "name": "is_completed",
      "value": "@item.completed"
    },
    {
      "name": "is_locked",
      "value": "!(@item.id == @local.current_module_id || @item.completed)",
      "exclude_from_translation": true
    },
    {
      "name": "background",
      "value": "@calc(@local.background_list.at(@local.index_modulo_3))"
    },
    {
      "type": "end_template",
      "exclude_from_translation": true
    },
    {
      "type": "end_data_items",
      "exclude_from_translation": true
    },
    {
      "type": "end_display_group"
    }
  ],
  "module_list_item": [
    {
      "name": "module_id",
      "value": "praise",
      "exclude_from_translation": true
    },
    {
      "name": "module_data_list_name",
      "value": "modules",
      "exclude_from_translation": true
    },
    {
      "name": "module_concat",
      "value": "@local.module_data_list_name.@local.module_id",
      "exclude_from_translation": true
    },
    {
      "name": "module_row",
      "value": "@data.@local.module_concat",
      "exclude_from_translation": true
    },
    {
      "name": "module_image_asset",
      "value": "@local.module_row.bottom_aligned_image_asset",
      "exclude_from_translation": true
    },
    {
      "name": "nav_image_asset",
      "value": "images/icons/expand_circle_right.svg",
      "exclude_from_translation": true
    },
    {
      "name": "locked_image_asset",
      "value": "images/icons/lock.svg",
      "exclude_from_translation": true
    },
    {
      "name": "is_locked",
      "value": false,
      "exclude_from_translation": true
    },
    {
      "name": "module_title",
      "value": "@local.module_row.title",
      "exclude_from_translation": true
    },
    {
      "name": "target_template",
      "value": "module_landing_@local.module_id",
      "exclude_from_translation": true
    },
    {
      "name": "completed_image_asset",
      "value": "images/icons/verified.svg",
      "exclude_from_translation": true
    },
    {
      "name": "is_completed",
      "value": false,
      "exclude_from_translation": true
    },
    {
      "name": "is_highlighted",
      "value": true,
      "exclude_from_translation": true,
      "comment": "!@local.is_locked && !@local.is_completed"
    },
    {
      "name": "background",
      "value": "var(--plh-module-list-item-background-1)",
      "exclude_from_translation": true
    },
    {
      "type": "plh_module_list_item",
      "name": "plh_module_list_item",
      "value": "@local.module_title",
      "action_list": "click | go_to: @local.target_template",
      "parameter_list": "module_image_asset: @local.module_image_asset;\nnav_image_asset: @local.nav_image_asset;\nlocked_image_asset: @local.locked_image_asset;\ncompleted_image_asset: @local.completed_image_asset;\ncompleted: @local.is_completed;\nis_locked: @local.is_locked;\nhighlighted: @local.is_highlighted;\nbackground: @local.background;",
      "exclude_from_translation": true
    }
  ],
  "module_path_debug": [
    {
      "name": "current_module_id"
    },
    {
      "name": "completed_count"
    },
    {
      "type": "data_items",
      "value": "@data.module_tasks",
      "action_list": "data_changed | set_local : completed_count : @items.length",
      "parameter_list": "filter: @item.completed;",
      "comments": "Use a counter variable as a means to track the difference in case where there is no current_module_id due to all modules being completed, vs the data_loop not yet evaluated"
    },
    {
      "type": "data_items",
      "value": "@data.module_tasks",
      "action_list": "data_changed | set_local : current_module_id : @items[0]?.id",
      "parameter_list": "\nfilter: !@item.completed;\nlimit: 1;",
      "comments": "Generate a list of the first non-completed items and update local variables when data changes\n\nUse ? operator to set fallback undefined if no value exists\n\nIMPORTANT - the item loop cannot have any inner child rows in order to set the item data (default sets inner row data), for convenience the `begin` and `end` statements can be dropped in favour of a single inline expression"
    },
    {
      "type": "text",
      "value": "Current Module: @local.current_module_id\nCompleted Count: @local.completed_count"
    },
    {
      "type": "title",
      "value": "Debug"
    },
    {
      "type": "begin_data_items",
      "value": "@data.module_tasks",
      "condition": "@local.completed_count !== undefined"
    },
    {
      "type": "begin_display_group",
      "exclude_from_translation": true
    },
    {
      "name": "unlocked",
      "value": "@item.id == @local.current_module_id || @item.completed",
      "comments": "Want a module to be unlocked if it's completed or if it's the first uncompleted"
    },
    {
      "type": "toggle_bar",
      "value": "@item.completed",
      "action_list": "changed | set_item | completed: !@item.completed"
    },
    {
      "type": "text",
      "value": "@item.id"
    },
    {
      "type": "text",
      "value": "🟢Unlocked",
      "condition": "@local.unlocked"
    },
    {
      "type": "text",
      "value": "🔒Locked",
      "condition": "!@local.unlocked"
    },
    {
      "type": "end_display_group"
    },
    {
      "type": "end_data_items"
    },
    {
      "type": "end_plh_progress_path"
    }
  ],
  "gen_stack_module": [
    {
      "type": "begin_template",
      "name": "module",
      "value": "module",
      "action_list": "completed | nav_stack: close_top; \nuncompleted | nav_stack: close_top;",
      "exclude_from_translation": true
    },
    {
      "name": "module_id",
      "value": "@gen.id",
      "exclude_from_translation": true
    },
    {
      "name": "show_progress_bar",
      "value": false,
      "exclude_from_translation": true
    },
    {
      "type": "begin_nested_properties",
      "name": "article_last",
      "exclude_from_translation": true
    },
    {
      "type": "begin_nested_properties",
      "name": "article",
      "exclude_from_translation": true
    },
    {
      "type": "begin_nested_properties",
      "name": "nav_buttons",
      "exclude_from_translation": true
    },
    {
      "name": "next_icon_src",
      "value": "@global.subsequent_completion_icon",
      "exclude_from_translation": true
    },
    {
      "type": "end_nested_properties",
      "exclude_from_translation": true
    },
    {
      "type": "end_nested_properties",
      "exclude_from_translation": true
    },
    {
      "type": "end_nested_properties",
      "exclude_from_translation": true
    },
    {
      "type": "end_template",
      "exclude_from_translation": true
    }
  ],
  "gen_stack_module_start_at_id": [
    {
      "type": "begin_data_items",
      "name": "pick_random_locked_activity",
      "value": "@data.activity_tasks",
      "parameter_list": "filter: @item.locked && (@fields.child_age === undefined || !@item.child_age_list || ([].concat(@item.child_age_list)).map(x => String(x)).includes(String(@fields.child_age)));\nshuffle;\nlimit: 1;",
      "exclude_from_translation": true,
      "comments": "filter: @item.locked && (!@item.child_age_list || @item.child_age_list.includes(@fields.child_age));\nshuffle;\nlimit: 1;"
    },
    {
      "type": "begin_template",
      "name": "module_start_at_id",
      "value": "module_start_at_id",
      "action_list": "completed | set_item | locked: false; \ncompleted | set_data | _list_id: module_tasks, _id: @gen.id, unlocked_activity: TRUE;\ncompleted | set_field: latest_unlocked_activity: @item.id;\ncompleted | nav_stack: close_top; \ncompleted | pop_up: unlock_play | variant: plh_completion;\nuncompleted | nav_stack: close_top;",
      "exclude_from_translation": true
    },
    {
      "name": "module_id",
      "value": "@gen.id"
    },
    {
      "name": "article_id",
      "value": "@fields.current_start_article_id"
    },
    {
      "type": "begin_nested_properties",
      "name": "module"
    },
    {
      "name": "show_progress_bar",
      "value": false
    },
    {
      "type": "end_nested_properties"
    },
    {
      "type": "end_template",
      "exclude_from_translation": true
    },
    {
      "type": "end_data_items"
    }
  ],
  "module_landing": [
    {
      "type": "update_action_list",
      "name": "custom_actions_1",
      "action_list": "nav_resume | emit: force_reload",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "name": "module_id",
      "value": "selfcare",
      "exclude_from_translation": true
    },
    {
      "name": "module_concat",
      "value": "modules.@local.module_id",
      "exclude_from_translation": true
    },
    {
      "name": "module_row",
      "value": "@data.@local.module_concat",
      "exclude_from_translation": true
    },
    {
      "name": "categories",
      "value": "_category_tasks",
      "exclude_from_translation": true
    },
    {
      "name": "category_data",
      "value": "@local.module_id@local.categories",
      "exclude_from_translation": true
    },
    {
      "type": "begin_display_group",
      "name": "dg_top",
      "exclude_from_translation": true
    },
    {
      "name": "bg_illustration",
      "value": "images/backgrounds/progress_arc.png",
      "exclude_from_translation": true
    },
    {
      "type": "plh_module_details_header",
      "name": "plh_module_details_header",
      "value": "@local.module_row.title",
      "parameter_list": "background_image_asset: @local.bg_illustration;\nmodule_image_asset: @local.module_row.image_asset;",
      "exclude_from_translation": true
    },
    {
      "type": "end_display_group",
      "exclude_from_translation": true
    },
    {
      "name": "hp_review_count"
    },
    {
      "type": "data_items",
      "name": "hp_review_exists",
      "value": "hp_check_in",
      "action_list": "data_changed | set_local : hp_review_count : @items.length",
      "parameter_list": "filter: @item.id == @local.module_id"
    },
    {
      "type": "text",
      "name": "debug_hp_review_count",
      "value": "hp_review_count: @local.hp_review_count",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "type": "begin_display_group",
      "name": "dg_bottom",
      "parameter_list": "variant: inline_padding; style: column",
      "exclude_from_translation": true
    },
    {
      "type": "begin_display_group",
      "name": "dg_wheel_and_hp",
      "style_list": "justify-content: space-evenly;\nalign-items: flex-end;",
      "exclude_from_translation": true
    },
    {
      "name": "articles",
      "value": "_article_tasks",
      "exclude_from_translation": true
    },
    {
      "name": "articles_data_list_name",
      "value": "@local.module_id@local.articles",
      "exclude_from_translation": true
    },
    {
      "name": "wheel_title",
      "value": "@global.completed",
      "exclude_from_translation": true
    },
    {
      "type": "task_progress_bar",
      "name": "task_progress_bar",
      "parameter_list": "task_group_data: @local.articles_data_list_name;\nfilter: !@task_item.nested;\nvariant: wheel;\nwheel_title: @local.wheel_title;",
      "style_list": "max-width: max-content;",
      "exclude_from_translation": true
    },
    {
      "name": "postcompose",
      "value": "_start_at_uncompleted",
      "exclude_from_translation": true
    },
    {
      "name": "module_start_at_uncompleted",
      "value": "stack_module_@local.module_id@local.postcompose",
      "exclude_from_translation": true
    },
    {
      "name": "start_at_id",
      "value": "_start_at_id"
    },
    {
      "name": "module_start_at_id",
      "value": "stack_module_@local.module_id@local.start_at_id"
    },
    {
      "name": "module_start_at_beginning",
      "value": "stack_module_@local.module_id",
      "exclude_from_translation": true
    },
    {
      "name": "hp_review",
      "value": "stack_hp_review_@local.module_id",
      "exclude_from_translation": true
    },
    {
      "name": "locked_icon_asset",
      "value": "images/icons/locked.png",
      "exclude_from_translation": true
    },
    {
      "name": "locked_image_asset",
      "value": "@global.hp_locked_image_asset"
    },
    {
      "name": "unlocked_icon_asset",
      "value": "images/icons/notification_bell.png",
      "exclude_from_translation": true
    },
    {
      "name": "unlocked_image_asset",
      "value": "@global.hp_unlocked_image_asset"
    },
    {
      "name": "countdown_text_list",
      "value": "@global.in_1_day; @global.in_2_days; @global.in_3_days; @global.in_4_days; @global.in_5_days; @global.in_6_days; @global.in_7_days",
      "exclude_from_translation": true
    },
    {
      "type": "begin_data_items",
      "name": "check_in",
      "value": "module_tasks",
      "parameter_list": "filter: @item.id == @local.module_id",
      "condition": "!!@local.hp_review_count",
      "exclude_from_translation": true
    },
    {
      "type": "text",
      "name": "debug_ts",
      "value": "Completed timestamp: @item.completed_ts",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "type": "plh_activity_check_in",
      "name": "button_hp_review",
      "action_list": "click | nav_stack: open | template: @local.hp_review",
      "parameter_list": "title: @global.check_in;\nlocked_icon_asset: @local.locked_icon_asset;\nlocked_image_asset: @local.locked_image_asset;\nunlocked_icon_asset: @local.unlocked_icon_asset;\nunlocked_image_asset: @local.unlocked_image_asset;\ncountdown_days: @fields.countdown_days;\ncountdown_start_date: @item.completed_ts;\ncountdown_text_list: @local.countdown_text_list",
      "exclude_from_translation": true
    },
    {
      "type": "end_data_items",
      "exclude_from_translation": true
    },
    {
      "type": "end_display_group",
      "exclude_from_translation": true
    },
    {
      "type": "begin_data_items",
      "name": "loop_outer",
      "value": "module_tasks",
      "parameter_list": "filter: @item.id == @local.module_id",
      "exclude_from_translation": true
    },
    {
      "type": "begin_display_group",
      "name": "dg_module_not_completed",
      "parameter_list": "style: column",
      "condition": "!@item.completed",
      "exclude_from_translation": true
    },
    {
      "type": "begin_template",
      "name": "loop_inner",
      "value": "module_landing_sub",
      "exclude_from_translation": true
    },
    {
      "name": "module_start_at_id",
      "value": "@local.module_start_at_id"
    },
    {
      "name": "articles_data_list_name",
      "value": "@local.articles_data_list_name"
    },
    {
      "name": "module_id",
      "value": "@local.module_id"
    },
    {
      "type": "end_template",
      "exclude_from_translation": true
    },
    {
      "type": "end_display_group",
      "exclude_from_translation": true
    },
    {
      "type": "button",
      "name": "button_restart",
      "value": "@global.restart",
      "action_list": "click | nav_stack: open | template: @local.module_start_at_beginning, header: false;",
      "condition": "@item.completed",
      "exclude_from_translation": true
    },
    {
      "type": "end_data_items"
    },
    {
      "type": "end_display_group"
    }
  ],
  "module_landing_sub": [
    {
      "name": "module_start_at_id"
    },
    {
      "name": "articles_data_list_name"
    },
    {
      "name": "module_id"
    },
    {
      "type": "begin_data_items",
      "name": "loop_inner",
      "value": "@local.articles_data_list_name",
      "parameter_list": "filter: !@item.completed; \nlimit: 1",
      "exclude_from_translation": true
    },
    {
      "type": "text",
      "name": "first_uncompleted_article_id",
      "value": "@item.id",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "type": "button",
      "name": "button_start",
      "value": "@global.lets_begin",
      "action_list": "click | set_field: current_start_article_id: @item.id;\nclick | nav_stack: open | template: @local.module_start_at_id, header: false;\nclick | set_data | _list_id: module_tasks, _id: @local.module_id, started_ts: @calc(now());",
      "condition": "@item.row_index == 0",
      "exclude_from_translation": true
    },
    {
      "type": "button",
      "name": "button_continue",
      "value": "@global.continue",
      "action_list": "click | set_field: current_start_article_id: @item.id;\nclick | nav_stack: open | template: @local.module_start_at_id, header: false;",
      "condition": "@item.row_index != 0",
      "exclude_from_translation": true
    },
    {
      "type": "end_data_items",
      "exclude_from_translation": true
    }
  ],
  "gen_module_landing": [
    {
      "type": "begin_template",
      "name": "module_landing",
      "value": "module_landing",
      "action_list": "completed | emit: completed; \nuncompleted | emit: uncompleted"
    },
    {
      "name": "module_id",
      "value": "@gen.id"
    },
    {
      "type": "end_template"
    }
  ]
}